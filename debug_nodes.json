[{"parameters":{"public":true,"mode":"webhook","options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-400,-140],"id":"be690cb2-1ff3-49ab-b02a-2c1d4a898ebe","name":"When chat message received","webhookId":"5710d4d5-501b-460e-a97a-5a113fe02ebb"},{"parameters":{"options":{"systemMessage":"# Rol\nAct√∫a como un asistente virtual especializado en marketing, comunicaci√≥n y branding, representando a Manu Santana, actual Director de Marketing en Zumex y profesional con m√°s de 15 a√±os de experiencia en distintos sectores. Est√°s profundamente formado en neuromarketing, branding y estrategias de posicionamiento de marca, con una perspectiva reflexiva, estrat√©gica y creativa sobre la imagen corporativa y el papel del marketing en las empresas, especialmente en pymes.\n\n# Tarea\nTu objetivo es atender a los visitantes del sitio web de Manu Santana, ofreciendo informaci√≥n clara y relevante sobre su experiencia, visi√≥n profesional, art√≠culos y publicaciones. Adem√°s, informa sobre los servicios de auditor√≠a de marketing que ofrece de forma independiente, como complemento a su trabajo actual. Ayuda a resolver dudas frecuentes, redirige a las secciones del sitio donde se ampl√≠a la informaci√≥n y facilita el contacto directo para colaboraciones o consultas profesionales.\n\n# Detalles Espec√≠ficos\n- Responde en primera persona, como si fueras Manu Santana (por ejemplo: ‚ÄúCreo firmemente que‚Ä¶‚Äù).\n- Utiliza un lenguaje cercano, profesional y reflexivo, alineado con el estilo de los art√≠culos del sitio.\n- Hazlo accesible para todo tipo de p√∫blico, desde personas interesadas en marketing hasta profesionales del sector.\n- Redirige a los art√≠culos publicados cuando una duda est√© relacionada con temas ya tratados.\n- Informa de manera clara y honesta sobre los servicios de auditor√≠a de marketing, especificando que son una actividad freelance complementaria.\n- Muestra disponibilidad para ser contactado directamente en caso de consultas espec√≠ficas o colaboraciones.\n- Me gustar√≠a que cuando alguien pregunte algo que no tenga que ver con el campo del marketing, comunicaci√≥n, branding o estrategia de negocio, que amablemente responda que este chat no es para resolver este tipo de dudas.\n\n# Contexto\nEl sitio web de Manu Santana refleja una trayectoria profesional basada en la reflexi√≥n estrat√©gica sobre el marketing, el neuromarketing y la construcci√≥n de marca. En los art√≠culos publicados, se profundiza sobre la esencia del branding, la importancia del marketing en las pymes, el papel del dise√±o en el packaging y la necesidad de que el marketing est√© integrado en todos los niveles de la empresa. Adem√°s de su actual puesto como Director de Marketing en Zumex, Manu ofrece servicios independientes de auditor√≠a de marketing para ayudar a otras empresas a identificar oportunidades de mejora y alinear sus estrategias con sus objetivos de marca.\n\n# Ejemplos\n\n- **Pregunta:** ¬øOfreces servicios de auditor√≠a de marketing?\n  **Respuesta:** S√≠, adem√°s de mi trabajo como Director de Marketing en Zumex, ofrezco servicios de auditor√≠a de marketing de forma independiente. Analizo la situaci√≥n actual de tu estrategia, imagen y canales de comunicaci√≥n para proponerte mejoras alineadas con tu posicionamiento. Si est√°s interesado, puedes escribirme directamente a trav√©s del formulario de contacto.\n\n- **Pregunta:** ¬øQui√©n eres y cu√°l es tu trayectoria?\n  **Respuesta:** Soy Manu Santana, Director de Marketing en Zumex. Tengo m√°s de 15 a√±os de experiencia en marketing y comunicaci√≥n en distintos sectores, y me apasiona ayudar a construir marcas s√≥lidas con prop√≥sito, desde una perspectiva estrat√©gica y emocional.\n\n- **Pregunta:** ¬øQu√© es para ti una marca?\n  **Respuesta:** Una marca es mucho m√°s que un logotipo. Es una promesa, una personalidad y una experiencia. Es algo intangible que se almacena en la mente del consumidor. De hecho, escrib√≠ un art√≠culo sobre esto bas√°ndome en un manifiesto de Motorola, que te invito a leer en mi sitio web.\n\n# Notas\n- Mant√©n siempre un tono profesional, cercano y alineado con la voz de Manu Santana.\n- No inventes informaci√≥n ni hables en tercera persona; comun√≠cate como si fueras √©l.\n- Si se trata de temas complejos o t√©cnicos, expl√≠calos con ejemplos y en un lenguaje sencillo.\n- Redirige a los art√≠culos del sitio cuando el contenido ya haya sido tratado.\n- Informa con claridad sobre el servicio de auditor√≠as como un proyecto personal adicional, no vinculado directamente a Zumex.\n- Ofrece siempre la opci√≥n de contacto directo ante consultas m√°s espec√≠ficas o propuestas de colaboraci√≥n.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-180,-140],"id":"a243bdf8-bb58-4dd8-bbe9-11acbcce69e9","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{"frequencyPenalty":0,"maxTokens":-1,"responseFormat":"text","temperature":0.7,"timeout":60000,"maxRetries":2,"topP":1}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-160,80],"id":"ecfa5105-1466-4e65-be4a-7d73ab755f32","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"2hav82eKKT2LEptu","name":"Openai - n8n"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[0,80],"id":"6073f1db-25ef-4b24-bf4e-6e8f12567c90","name":"Simple Memory"}]
[{"parameters":{"updates":["message"],"additionalFields":{"userIds":"7284267714"}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.2,"position":[-448,0],"id":"97d8f78e-d316-4afa-bd99-935847178a30","name":"Telegram Trigger","webhookId":"b522a8fe-76eb-4c56-8ded-52ee891bbf26","credentials":{"telegramApi":{"id":"yDpQzNCgbZRDEeGA","name":"Telegram account"}}},{"parameters":{"documentId":{"__rl":true,"value":"https://docs.google.com/spreadsheets/d/1E5gQDV1xRswrj2qljb7C3xzSyrjjacLdS6Y5vMkM5V0/edit?gid=0#gid=0","mode":"url"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Hoja 1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1E5gQDV1xRswrj2qljb7C3xzSyrjjacLdS6Y5vMkM5V0/edit#gid=0"},"options":{"dataLocationOnSheet":{"values":{"rangeDefinition":"detectAutomatically"}}}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.7,"position":[-192,0],"id":"54be314c-f2bb-4210-bf5c-0d34383e87d5","name":"Get row(s) in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"l2xD3QINvvmbY8nJ","name":"Google Sheets account"}}},{"parameters":{"jsCode":"// --- 1. OBTENER INPUTS ---\n// Buscamos el mensaje original del usuario en el nodo Trigger\nconst triggerData = $('Telegram Trigger').first();\nconst userMsg = triggerData ? triggerData.json.message.text : \"1\"; // Fallback para tests\n\n// Buscamos los datos de Google Sheets (Input directo de este nodo)\n// Cogemos la √öLTIMA fila, que es la de hoy\nconst lastRow = items[items.length - 1].json;\n\n// --- 2. VALIDACI√ìN ---\nconst selection = parseInt(userMsg);\n\n// Validamos que sea un n√∫mero entre 1 y 4\nif (isNaN(selection) || selection < 1 || selection > 4) {\n  return { json: { error: \"‚ö†Ô∏è Input no v√°lido. Escribe un n√∫mero del 1 al 4.\", valid: false } };\n}\n\n// --- 3. EXTRACCI√ìN DEL TEMA ---\nlet memory;\ntry {\n  // Intentamos leer el JSON. Si est√° vac√≠o o mal formado, no explota.\n  memory = lastRow.data_json ? JSON.parse(lastRow.data_json) : {};\n} catch (e) {\n  return { json: { error: \"‚ùå Error cr√≠tico: La memoria del d√≠a est√° corrupta o el JSON es inv√°lido.\", valid: false } };\n}\n\n// === EL FIX EST√Å AQU√ç ===\n// Si 'topics' no existe, usamos una lista vac√≠a [] para que NO de error \"undefined\"\nconst topics = memory.topics || []; \n\n// Array empieza en 0, as√≠ que restamos 1 (Input \"1\" = Index 0)\n// Ahora 'topics' siempre es un array, as√≠ que esto es seguro\nconst topic = topics[selection - 1];\n\nif (!topic) {\n  // Si no encuentra el tema, avisa claramente en vez de dar error 500\n  return { json: { error: `‚ùå Tema no encontrado. El sistema ha le√≠do ${topics.length} temas. (Revisa si ejecutaste Content Factory hoy)`, valid: false } };\n}\n\n// --- 4. PREPARAR PAQUETE PARA LA IA ---\nreturn {\n  json: {\n    valid: true,\n    user_selection: selection,\n    topic_title: topic.title,\n    topic_rationale: topic.rationale,\n    topic_sources: topic.sources ? topic.sources.join(\", \") : \"Varias fuentes\",\n    system_instruction: \"Genera un post de LinkedIn viral, t√©cnico y directo.\"\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[64,0],"id":"ae5a1d9b-0b8b-4ea4-88ea-fd7633a09c57","name":"Code in JavaScript"},{"parameters":{"modelId":{"__rl":true,"value":"models/gemini-2.5-flash","mode":"list","cachedResultName":"models/gemini-2.5-flash"},"messages":{"values":[{"content":"=Act√∫a como YO, Manu Santana. Soy Head of Marketing y experto en Growth de negocio y Marketing, con un tono directo, un poco canalla, muy t√©cnico pero sin palabras de relleno. Odio el lenguaje corporativo tipo \"en el panorama actual\". Soy un apasionado de la IA y la aplico en mi d√≠a a d√≠a. Me quiero posicionar como el mayor experto en Transformar departamentos de marketing traducionales en nuevos departamentos de marketing preparados para IA, ahorrando costes a la empresas y siendo m√°s productivos.\n\nMI ESTILO DE ESCRITURA:\n- Frases cortas. Punchy.\n- Uso de flechas (->) o listas para explicar l√≥gica.\n- Preguntas ret√≥ricas para enganchar.\n- Cero paja. Voy al grano.\n- Escribe segunda persona del singular. \"Prep√°rate. Lo que vamos a discutir no es un futuro prometedor, ni una tendencia emergente. Es una realidad que Google acaba de poner sobre la mesa y que va a cambiar, de forma radical, las reglas del juego del comercio online. Olvida las predicciones.\"\n- Cero palabras mal sonantes. S√© educado.\n\nEJEMPLO DE C√ìMO ESCRIBO (Imita este tono):\n\"Excelente primera jornada representando a Zumex Group en el EDEM Escuela de Empresarios del hashtag#programa hashtag#agroalimentario con un interesante caf√© con Hortensia Roig y ponentes top como: Jos√© Mar√≠a Bonmat√≠ Eduardo Baamonde Leonor S√°iz Amor√≥s V√≠ctor Yuste Jord√°n y Manuel Lainez AndreÃÅs Ma√±ana m√°s y mejor!\"\n\"Gran gala de los hashtag#premiosmia24 organizada por el Club Marketing Mediterr√°neo y la inspiradora charla de Amuda Goueli para seguir innovando y el gran valor estrat√©gico del √°rea de marketing en los mejores, y sobre todo, en los peores momentos. Muchas gracias por esa inspiraci√≥n para todo el equipo Zumex Group que represento esta noche.\"\n\nDATOS DEL TEMA DE HOY:\n- T√≠tulo: {{ $json.topic_title }}\n- Raz√≥n: {{ $json.topic_rationale }}\n- Fuentes: {{ $json.topic_sources }}\n\nTU TAREA:\nGenera un objeto JSON v√°lido (sin markdown) con dos campos:\n\n1. \"linkedin_content\":\n   - Post de LinkedIn siguiendo MI ESTILO.\n   - M√°ximo 150 palabras.\n   - Empieza con una afirmaci√≥n pol√©mica.\n\n2. \"blog_content\":\n   - Art√≠culo HTML para WordPress de aproximadamente 800 palabras (solo el body, sin <html>).\n   - Usa <h2>, <p>, <ul> optimizado para SEO.\n   - IDIOMA: El contenido debe estar escrito √öNICAMENTE en ESPA√ëOL.\n   - Tono educativo pero entretenido.\n\n3. \"image_prompt\":\n   - TU MISI√ìN: Escribir un prompt descriptivo en ingl√©s para generar la imagen de portada.\n   - CONTENIDO OBLIGATORIO: La imagen DEBE representar visualmente los conceptos clave del art√≠culo (T√≠tulo: {{ $json.topic_title }}).\n   - EJEMPLOS VISUALES: Si el texto habla de \"Google UCP y carritos abandonados\", el prompt debe describir, por ejemplo, un logo de Google estilizado conectado por l√≠neas a un carrito de compra abstracto con un cerebro de IA dentro. S√© creativo con las met√°foras visuales del tema.\n   - ESTILO ART√çSTICO: Ilustraci√≥n digital conceptual imitando un boceto suelto hecho en iPad (estilo app Paper53).\n   - DETALLES DE ESTILO: Debe parecer hecho a mano, con texturas visibles de papel granulado, aguadas de acuarela (watercolor washes), y l√≠neas de tinta imperfectas y sueltas.\n   - Keywords finales a incluir siempre: \"Conceptual editorial illustration, digital sketch, Paper53 style, watercolor and ink on textured paper, hand-drawn, loose brushstrokes, minimalist.\"\n\nOUTPUT FORMAT (JSON RAW):\n{\n  \"linkedin_content\": \"...\",\n  \"blog_content\": \"...\"\n}\nIMPORTANTE: El JSON debe ser v√°lido. Escapa los saltos de l√≠nea del texto usando \\n. No uses saltos de l√≠nea reales dentro de los valores."}]},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1.1,"position":[272,0],"id":"f854748b-fa7f-4bdc-a7ca-6c4f2c83854d","name":"Message a model","credentials":{"googlePalmApi":{"id":"ScgXEyFYKFmtP8M4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsCode":"// 1. Limpieza JSON (Igual que antes)\nconst root = items[0].json;\nconst rawText = (root.content && root.content.parts) ? root.content.parts[0].text : root.text;\n\n// Buscador de llaves para evitar basura\nconst firstBrace = rawText.indexOf('{');\nconst lastBrace = rawText.lastIndexOf('}');\nlet cleanJSON = rawText;\n\nif (firstBrace !== -1 && lastBrace !== -1) {\n    cleanJSON = rawText.substring(firstBrace, lastBrace + 1);\n}\n\n// 2. Fix saltos de l√≠nea y Parseo\nlet content = {};\ntry {\n    const fixedJSON = cleanJSON.replace(/\\n/g, \"\\\\n\").replace(/\\r/g, \"\");\n    content = JSON.parse(fixedJSON);\n} catch (e) {\n    try { content = JSON.parse(cleanJSON); } catch(e2) {\n        content = { linkedin_content: \"‚ö†Ô∏è Error formato\", blog_content: \"Error\" };\n    }\n}\n\n// 3. RECUPERAR T√çTULO ORIGINAL\nlet originalTitle = \"Borrador Autom√°tico\";\ntry {\n    originalTitle = $('Code in JavaScript').first().json.target_topic.title; \n} catch(e) {\n    try { originalTitle = $('Code in JavaScript').first().json.topic_title; } catch(e2) {}\n}\n\n// SALIDA ACTUALIZADA CON EL PROMPT DE IMAGEN\nreturn {\n    json: {\n        title: originalTitle,\n        linkedin_draft: content.linkedin_content || content.linkedin_draft,\n        blog_draft: content.blog_content || content.blog_draft,\n        // A√ëADIMOS ESTA L√çNEA:\n        image_prompt: content.image_prompt || \"Futuristic technology concept, editorial photography, 8k\" // Fallback por si acaso\n    }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[608,0],"id":"9a50eba4-e10c-4709-a4ec-776ccb89ba18","name":"Code"},{"parameters":{"chatId":"7284267714","text":"=üöÄ *WORKFLOW COMPLETADO*\n\nüì± *Para LinkedIn (Copiar y Pegar):*\n-----------------------------\n{{ $('Code').item.json.linkedin_draft }}\n-----------------------------\n\nüìù *WordPress:*\n‚úÖ Borrador creado correctamente:\nTitle: {{ $json.title.rendered || $json.title }}\nID: {{ $json.id }}\n\n(Entra a tu WP para editar y publicar el art√≠culo)","additionalFields":{"parse_mode":"Markdown"}},"id":"79d42b9e-8d34-452a-ab50-b83fc9290f1b","name":"Notificar a Manu","type":"n8n-nodes-base.telegram","typeVersion":1.1,"position":[1760,0],"webhookId":"1e5f367b-022f-4c81-992c-77a37e7ac330","credentials":{"telegramApi":{"id":"yDpQzNCgbZRDEeGA","name":"Telegram account"}}},{"parameters":{"resource":"image","modelId":{"__rl":true,"value":"models/gemini-2.5-flash-image","mode":"list","cachedResultName":"models/gemini-2.5-flash-image (Nano Banana)"},"prompt":"3. \"image_prompt\":\n   - TU MISI√ìN: Escribir un prompt descriptivo en ingl√©s para generar la imagen de portada.\n   - CONTENIDO OBLIGATORIO: La imagen DEBE representar visualmente los conceptos clave del art√≠culo (T√≠tulo: {{ $json.topic_title }}).\n   - EJEMPLOS VISUALES: Si el texto habla de \"Google UCP y carritos abandonados\", el prompt debe describir, por ejemplo, un logo de Google estilizado conectado por l√≠neas a un carrito de compra abstracto con un cerebro de IA dentro. S√© creativo con las met√°foras visuales del tema.\n   - ESTILO ART√çSTICO: Ilustraci√≥n digital conceptual imitando un boceto suelto hecho en iPad (estilo app Paper53).\n   - DETALLES DE ESTILO: Debe parecer hecho a mano, con texturas visibles de papel granulado, aguadas de acuarela (watercolor washes), y l√≠neas de tinta imperfectas y sueltas.\n   - Keywords finales a incluir siempre: \"Conceptual editorial illustration, digital sketch, Paper53 style, watercolor and ink on textured paper, hand-drawn, loose brushstrokes, minimalist.\"","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1.1,"position":[800,0],"id":"5011b4c8-f55e-42ec-b2ab-5309120e3f09","name":"Generate an image","credentials":{"googlePalmApi":{"id":"ScgXEyFYKFmtP8M4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"method":"POST","url":"https://manusantana.com/wp-json/wp/v2/media","authentication":"predefinedCredentialType","nodeCredentialType":"wordpressApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"User-Agent","value":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"},{"name":"Content-Disposition","value":"attachment; filename=portada_ia.png"}]},"sendBody":true,"contentType":"binaryData","inputDataFieldName":"=data","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[1264,0],"id":"66365db8-4ed9-4e7a-bb94-2cf8e674e1d1","name":"HTTP Request","credentials":{"wordpressApi":{"id":"wfB9IY5mVyTdtlVF","name":"Wordpress account"}}},{"parameters":{"method":"POST","url":"https://manusantana.com/wp-json/wp/v2/posts","authentication":"predefinedCredentialType","nodeCredentialType":"wordpressApi","sendBody":true,"bodyParameters":{"parameters":[{"name":"=title","value":"={{ $('Code').item.json.title }}"},{"name":"=content","value":"={{ $('Code').item.json.blog_draft }}"},{"name":"=status","value":"draft"},{"name":"featured_media","value":"={{ $json.id }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[1504,0],"id":"d6d4277d-c13c-4744-a942-d06e5df74d25","name":"Wordpress Connect","credentials":{"wordpressApi":{"id":"wfB9IY5mVyTdtlVF","name":"Wordpress account"}}},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1040,0],"id":"40c54081-e8c0-4a62-8902-ca86f9267278","name":"Wait","webhookId":"c710ee37-d4e0-4f18-bc2e-95595a2d4b8a"}]
